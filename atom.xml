<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>乱序的博客</title>
  
  <subtitle>LuanXu&#39;s Blog</subtitle>
  <link href="https://luanxu.me/atom.xml" rel="self"/>
  
  <link href="https://luanxu.me/"/>
  <updated>2021-08-28T14:58:24.741Z</updated>
  <id>https://luanxu.me/</id>
  
  <author>
    <name>LuanXu</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>JSON.stringify中的replacer</title>
    <link href="https://luanxu.me/posts/29099/"/>
    <id>https://luanxu.me/posts/29099/</id>
    <published>2021-08-25T05:00:32.000Z</published>
    <updated>2021-08-28T14:58:24.741Z</updated>
    
    <content type="html"><![CDATA[<h2 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h2><p>当我们在遇到需要深拷贝一个对象所有属性的时候<br>会想把关联的数据排除在外，例如这样的一个对象关联的send_by_user</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">41</span>,</span><br><span class="line">    <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;消息标题&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;content&quot;</span>: <span class="string">&quot;消息内容&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;send_by&quot;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">&quot;send_by_user&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;guoguixin&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;telephone&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;email&quot;</span>: <span class="string">&quot;10000@qq.com&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;department_id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">&quot;department_name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;department&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;产品设计部&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;status&quot;</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">&quot;created_at&quot;</span>: <span class="string">&quot;1970-01-01T08:00:00+08:00&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;updated_at&quot;</span>: <span class="string">&quot;2021-08-21T16:12:05+08:00&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;status&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">&quot;info&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;created_at&quot;</span>: <span class="string">&quot;1970-01-01T08:00:00+08:00&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;updated_at&quot;</span>: <span class="string">&quot;1970-01-01T08:00:00+08:00&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;send_to&quot;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">&quot;status&quot;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">&quot;created_at&quot;</span>: <span class="string">&quot;2021-08-21T16:55:53+08:00&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;deleted_at&quot;</span>: <span class="string">&quot;0001-01-01T00:00:00Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;updated_at&quot;</span>: <span class="string">&quot;2021-08-25T10:14:57+08:00&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当你的需求是修改这个对象并且整体提交更新的时候会发现以下问题</p><ol><li>这个多余关联的对象不需要提交</li><li>发出请求的数据量变大</li></ol><h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>控制 JSON.stringify 序列化层级<br><code>JSON.stringify(value[, replacer [, space]])</code></p><p>使用JSON.stringify时传入第二个参数</p><ul><li>replacer 可选<br>如果该参数是一个函数，则在序列化过程中，被序列化的值的每个属性都会经过该函数的转换和处理；如果该参数是一个数组，则只有包含在这个数组中的属性名才会被序列化到最终的 JSON 字符串中；如果该参数为 null 或者未提供，则对象所有的属性都会被序列化。</li></ul><p>那我们只需要通过replacer传入函数过滤掉属性值是Object即可</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.stringify(message,<span class="function">(<span class="params">k,v</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// k,v分别代表传入对象的属性名和属性值</span></span><br><span class="line">    <span class="comment">// 判断k是因为replace会传入一个 传入参数对象 的值,但是没有k, 我们直接返回即可</span></span><br><span class="line">    <span class="keyword">if</span>(k) &#123;</span><br><span class="line">        <span class="keyword">return</span> v</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> v === <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><blockquote><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify">MDN Web Docs</a></li></ul></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;需求分析&quot;&gt;&lt;a href=&quot;#需求分析&quot; class=&quot;headerlink&quot; title=&quot;需求分析&quot;&gt;&lt;/a&gt;需求分析&lt;/h2&gt;&lt;p&gt;当我们在遇到需要深拷贝一个对象所有属性的时候&lt;br&gt;会想把关联的数据排除在外，例如这样的一个对象关联的send_by_use</summary>
      
    
    
    
    <category term="JavaScript" scheme="https://luanxu.me/categories/JavaScript/"/>
    
    
  </entry>
  
</feed>
